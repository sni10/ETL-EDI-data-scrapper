# etl-edi-scraper - –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π –±–µ–∫–ª–æ–≥

**–û–±–Ω–æ–≤–ª–µ–Ω–æ:** 2025-11-15
**–°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ:** ~75%
**–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –ø—Ä–æ–±–ª–µ–º:** 6
**Runtime –æ—à–∏–±–æ–∫:** 1

---

## üî¥ P0 - –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –ü–†–û–ë–õ–ï–ú–´ (–ù—É–∂–Ω–æ –∏—Å–ø—Ä–∞–≤–∏—Ç—å –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ)

### 1. Runtime –±–∞–≥ - –ù–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–∞ DataSetCollection
**–°—Ç–∞—Ç—É—Å:** üî¥ –ö—Ä–∏—Ç–∏—á–Ω–æ
**–§–∞–π–ª:** `src/Service/Mapper/Mapper.php:78`
**–¢–∏–ø:** Runtime Error

**–ü—Ä–æ–±–ª–µ–º–∞:**
```php
$mappedDataCollection = new DataSetCollection($rules);  // –û–®–ò–ë–ö–ê: –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä –Ω–µ –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
```

**–í–ª–∏—è–Ω–∏–µ:**
- –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ø–∞–¥–∞–µ—Ç –≤ runtime –∫–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è Mapper
- –ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä DataSetCollection –ù–ï –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –Ω–∏–∫–∞–∫–∏—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤

**–†–µ—à–µ–Ω–∏–µ:**
```php
$mappedDataCollection = new DataSetCollection();
$mappedDataCollection->setRules($rules);
```

**–ù–∞–∑–Ω–∞—á–µ–Ω–æ:** –ù–µ –Ω–∞–∑–Ω–∞—á–µ–Ω–æ
**–û—Ü–µ–Ω–∫–∞ —Ç—Ä—É–¥–æ–∑–∞—Ç—Ä–∞—Ç:** 5 –º–∏–Ω—É—Ç

---

### 2. –ù–∞—Ä—É—à–µ–Ω–∏–µ Factory Pattern - –ü—Ä—è–º–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ —Ö—ç–Ω–¥–ª–µ—Ä–æ–≤ –≤ Aggregator
**–°—Ç–∞—Ç—É—Å:** üî¥ –ö—Ä–∏—Ç–∏—á–Ω–æ
**–§–∞–π–ª:** `src/Service/Aggregator/Aggregator.php:93-98`
**–¢–∏–ø:** –ù–∞—Ä—É—à–µ–Ω–∏–µ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã

**–ü—Ä–æ–±–ª–µ–º–∞:**
–ü—Ä—è–º–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ —Ö—ç–Ω–¥–ª–µ—Ä–æ–≤ –≤ –æ–±—Ö–æ–¥ —Ñ–∞–±—Ä–∏–∫/DI –¥–ª—è —Ç–∏–ø–æ–≤ 2, 4, 6, 7:
```php
return match ($type_id) {
    2 => new CsvInputHandler($this->logger, $this->httpTransport),
    4 => new ExcelInputHandler($this->logger, $this->httpTransport),
    6 => new ExcelInputHandler($this->logger, null, $this->sftpTransportFactory->create(...)),
    7 => new CsvInputHandler($this->logger, null, $this->sftpTransportFactory->create(...)),
    // ...
};
```

**–í–ª–∏—è–Ω–∏–µ:**
- –ù–∞—Ä—É—à–∞–µ—Ç –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–π —Å—Ç–∞–Ω–¥–∞—Ä—Ç: "Never bypass factories for handler/transport creation"
- –ù–µ—Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç—å —Å —Ç–∏–ø–∞–º–∏ 1, 3, 5, 8 –∫–æ—Ç–æ—Ä—ã–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç DI/—Ñ–∞–±—Ä–∏–∫–∏
- –î–µ–ª–∞–µ—Ç —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–µ–≤–æ–∑–º–æ–∂–Ω—ã–º (–Ω–µ–ª—å–∑—è –∑–∞–º–æ–∫–∞—Ç—å —Ö—ç–Ω–¥–ª–µ—Ä—ã)
- –ù–∞—Ä—É—à–∞–µ—Ç –∞–≤—Ç–æ-wiring –ø–∞—Ç—Ç–µ—Ä–Ω Symfony

**–í–∞—Ä–∏–∞–Ω—Ç—ã —Ä–µ—à–µ–Ω–∏—è:**

**–í–∞—Ä–∏–∞–Ω—Ç A:** –°–æ–∑–¥–∞—Ç—å —Ñ–∞–±—Ä–∏–∫–∏ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
- –°–æ–∑–¥–∞—Ç—å `CsvInputHandlerFactory` –∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ `RestApiHandlerFactory`
- –°–æ–∑–¥–∞—Ç—å `ExcelInputHandlerFactory` –∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ `RestApiHandlerFactory`
- –ò–Ω–∂–µ–∫—Ç–∏—Ç—å —Ñ–∞–±—Ä–∏–∫–∏ –≤ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä Aggregator
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ñ–∞–±—Ä–∏–∫–∏ –≤ match –≤—ã—Ä–∞–∂–µ–Ω–∏–∏

**–í–∞—Ä–∏–∞–Ω—Ç B:** –ò–Ω–∂–µ–∫—Ç–∏—Ç—å –≤—Å–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã —Ö—ç–Ω–¥–ª–µ—Ä–æ–≤ —á–µ—Ä–µ–∑ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä
- –ò–Ω–∂–µ–∫—Ç–∏—Ç—å `CsvInputHandler` –¥–ª—è HTTP —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∞
- –ò–Ω–∂–µ–∫—Ç–∏—Ç—å `ExcelInputHandler` –¥–ª—è HTTP —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∞
- –°–æ–∑–¥–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω—ã–µ —ç–∫–∑–µ–º–ø–ª—è—Ä—ã —Ö—ç–Ω–¥–ª–µ—Ä–æ–≤ –¥–ª—è SFTP –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤
- –ë–æ–ª–µ–µ –º–Ω–æ–≥–æ—Å–ª–æ–≤–Ω—ã–π –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä

**–ù–∞–∑–Ω–∞—á–µ–Ω–æ:** –ù–µ –Ω–∞–∑–Ω–∞—á–µ–Ω–æ
**–û—Ü–µ–Ω–∫–∞ —Ç—Ä—É–¥–æ–∑–∞—Ç—Ä–∞—Ç:** 2-3 —á–∞—Å–∞

---

### 3. –ù–∞—Ä—É—à–µ–Ω–∏–µ Factory Pattern - –ü—Ä—è–º–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∞
**–°—Ç–∞—Ç—É—Å:** üî¥ –ö—Ä–∏—Ç–∏—á–Ω–æ
**–§–∞–π–ª:** `src/Service/InputHandler/MorrisXmlSftpInputHandler.php:18`
**–¢–∏–ø:** –ù–∞—Ä—É—à–µ–Ω–∏–µ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã

**–ü—Ä–æ–±–ª–µ–º–∞:**
```php
public function __construct(LoggerInterface $logger, string $configPath)
{
    $this->logger = $logger;
    $this->sftpTransport = new SftpTransport($logger, $configPath, '19');  // –•–∞—Ä–¥–∫–æ–¥ supplier_id!
}
```

**–í–ª–∏—è–Ω–∏–µ:**
- –û–±—Ö–æ–¥–∏—Ç `SftpTransportFactory`
- –•–∞—Ä–¥–∫–æ–¥ supplier_id '19' –¥–µ–ª–∞–µ—Ç —Ö—ç–Ω–¥–ª–µ—Ä –Ω–µ–ø–µ—Ä—Å–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–º
- –ù–µ—Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç—å —Å —Ç–µ–º –∫–∞–∫ Aggregator —Å–æ–∑–¥–∞–µ—Ç SFTP —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç—ã (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Ñ–∞–±—Ä–∏–∫—É)

**–†–µ—à–µ–Ω–∏–µ:**
```php
public function __construct(
    LoggerInterface $logger,
    SftpTransport $sftpTransport  // –ò–Ω–∂–µ–∫—Ç–∏—Ç—å —á–µ—Ä–µ–∑ DI –∏–ª–∏ —Ñ–∞–±—Ä–∏–∫—É
) {
    $this->logger = $logger;
    $this->sftpTransport = $sftpTransport;
}
```

–ò–ª–∏ –∏–Ω–∂–µ–∫—Ç–∏—Ç—å `SftpTransportFactory` –∏ —Å–æ–∑–¥–∞–≤–∞—Ç—å —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ supplier_id –∏–∑ InputConfig.

**–ù–∞–∑–Ω–∞—á–µ–Ω–æ:** –ù–µ –Ω–∞–∑–Ω–∞—á–µ–Ω–æ
**–û—Ü–µ–Ω–∫–∞ —Ç—Ä—É–¥–æ–∑–∞—Ç—Ä–∞—Ç:** 1 —á–∞—Å

---

## üü† P1 - –í–´–°–û–ö–ò–ô –ü–†–ò–û–†–ò–¢–ï–¢ (–ù—É–∂–Ω–æ –∏—Å–ø—Ä–∞–≤–∏—Ç—å –≤ –±–ª–∏–∂–∞–π—à–µ–µ –≤—Ä–µ–º—è)

### 4. –ù–∞—Ä—É—à–µ–Ω–∏–µ DI - –†—É—á–Ω–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ —Ö—ç–Ω–¥–ª–µ—Ä–æ–≤ –≤ GoogleDriveFolderHandler
**–°—Ç–∞—Ç—É—Å:** üü† –í—ã—Å–æ–∫–∏–π
**–§–∞–π–ª:** `src/Service/InputHandler/GoogleDriveFolderHandler.php:50-55`
**–¢–∏–ø:** –ù–∞—Ä—É—à–µ–Ω–∏–µ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã

**–ü—Ä–æ–±–ª–µ–º–∞:**
```php
switch ($fileType) {
    case 'csv':
        $csvHandler = new CsvInputHandler($this->logger);  // –†—É—á–Ω–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ!
        return $csvHandler->readData($tempPath, $range);
    case 'excel':
        $excelHandler = new ExcelInputHandler($this->logger);  // –†—É—á–Ω–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ!
        return $excelHandler->readData($tempPath, $range);
}
```

**–í–ª–∏—è–Ω–∏–µ:**
- –°–µ—Ä–≤–∏—Å–Ω—ã–π —Å–ª–æ–π –≤—Ä—É—á–Ω—É—é —Å–æ–∑–¥–∞–µ—Ç –¥—Ä—É–≥–∏–µ —Å–µ—Ä–≤–∏—Å—ã
- –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ –∑–∞–º–æ–∫–∞—Ç—å —Ö—ç–Ω–¥–ª–µ—Ä—ã –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
- –ù–µ—Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç—å —Å –ø—Ä–∏–Ω—Ü–∏–ø–∞–º–∏ DI

**–†–µ—à–µ–Ω–∏–µ:**
```php
public function __construct(
    LoggerInterface $logger,
    Client $googleClient,
    CsvInputHandler $csvHandler,  // –ò–Ω–∂–µ–∫—Ç–∏—Ç—å
    ExcelInputHandler $excelHandler  // –ò–Ω–∂–µ–∫—Ç–∏—Ç—å
) {
    // ...
}

// –ó–∞—Ç–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:
return match ($fileType) {
    'csv' => $this->csvHandler->readData($tempPath, $range),
    'excel' => $this->excelHandler->readData($tempPath, $range),
    default => throw new \RuntimeException("–ù–µ–ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–π —Ç–∏–ø —Ñ–∞–π–ª–∞: $fileType")
};
```

**–ù–∞–∑–Ω–∞—á–µ–Ω–æ:** –ù–µ –Ω–∞–∑–Ω–∞—á–µ–Ω–æ
**–û—Ü–µ–Ω–∫–∞ —Ç—Ä—É–¥–æ–∑–∞—Ç—Ä–∞—Ç:** 30 –º–∏–Ω—É—Ç

---

### 5. –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –≤–∞–ª–∏–¥–∞—Ü–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ - RestApiConfig
**–°—Ç–∞—Ç—É—Å:** üü† –í—ã—Å–æ–∫–∏–π
**–§–∞–π–ª:** `src/Service/Config/RestApiConfig.php:7-13`
**–¢–∏–ø:** –ù–∞—Ä—É—à–µ–Ω–∏–µ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã

**–ü—Ä–æ–±–ª–µ–º–∞:**
–ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä –∏—Å–ø–æ–ª—å–∑—É–µ—Ç property promotion –Ω–æ –ù–ï –≤—ã–ø–æ–ª–Ω—è–µ—Ç –≤–∞–ª–∏–¥–∞—Ü–∏—é:
```php
public function __construct(
    public readonly string $baseUri,
    public readonly array $auth,
    public readonly array $items,
    public readonly bool $verifySsl,
    public readonly array $transport = [],
) {}  // –ù–µ—Ç –≤–∞–ª–∏–¥–∞—Ü–∏–∏!
```

**–í–ª–∏—è–Ω–∏–µ:**
- –ù–∞—Ä—É—à–∞–µ—Ç —Å—Ç–∞–Ω–¥–∞—Ä—Ç: "Validate in constructor, throw InvalidArgumentException"
- –ù–µ–≤–∞–ª–∏–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (–ø—É—Å—Ç–æ–π baseUri, –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π URL) –ø—Ä–æ—Ö–æ–¥—è—Ç –Ω–µ–∑–∞–º–µ—Ç–Ω–æ
- –ù–µ—Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç—å —Å `InputConfig` –∏ `SubSource` –∫–æ—Ç–æ—Ä—ã–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –≤–∞–ª–∏–¥–∏—Ä—É—é—Ç
- –í–∞–ª–∏–¥–∞—Ü–∏—è –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø–æ–∑–∂–µ –≤ `RestApiHandlerFactory` –≤–º–µ—Å—Ç–æ —Å–∞–º–æ–≥–æ –æ–±—ä–µ–∫—Ç–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

**–†–µ—à–µ–Ω–∏–µ:**
```php
public function __construct(
    public readonly string $baseUri,
    public readonly array $auth,
    public readonly array $items,
    public readonly bool $verifySsl,
    public readonly array $transport = [],
) {
    if (empty($this->baseUri)) {
        throw new \InvalidArgumentException('RestApiConfig: baseUri –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—É—Å—Ç—ã–º');
    }

    if (!filter_var($this->baseUri, FILTER_VALIDATE_URL)) {
        throw new \InvalidArgumentException("RestApiConfig: baseUri –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤–∞–ª–∏–¥–Ω—ã–º URL, –ø–æ–ª—É—á–µ–Ω: {$this->baseUri}");
    }

    if (empty($this->auth)) {
        throw new \InvalidArgumentException('RestApiConfig: –º–∞—Å—Å–∏–≤ auth –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—É—Å—Ç—ã–º');
    }

    // –í–∞–ª–∏–¥–∞—Ü–∏—è –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö –ø–æ–ª–µ–π auth –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–∏–ø–∞
}
```

**–ù–∞–∑–Ω–∞—á–µ–Ω–æ:** –ù–µ –Ω–∞–∑–Ω–∞—á–µ–Ω–æ
**–û—Ü–µ–Ω–∫–∞ —Ç—Ä—É–¥–æ–∑–∞—Ç—Ä–∞—Ç:** 30 –º–∏–Ω—É—Ç

---

### 6. –ù–∞—Ä—É—à–µ–Ω–∏–µ Type Safety - –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç —Ç–∞–π–ø—Ö–∏–Ω—Ç
**–°—Ç–∞—Ç—É—Å:** üü† –í—ã—Å–æ–∫–∏–π
**–§–∞–π–ª:** `src/Service/InputHandler/GoogleApiInputHandler.php:13`
**–¢–∏–ø:** Type Safety

**–ü—Ä–æ–±–ª–µ–º–∞:**
```php
protected $service;  // –ù–µ—Ç —Ç–∞–π–ø—Ö–∏–Ω—Ç–∞!
```

**–í–ª–∏—è–Ω–∏–µ:**
- –ù–∞—Ä—É—à–∞–µ—Ç —Å—Ç–∞–Ω–¥–∞—Ä—Ç —Å—Ç—Ä–æ–≥–æ–π —Ç–∏–ø–∏–∑–∞—Ü–∏–∏ PHP 8.2+
- –°–Ω–∏–∂–∞–µ—Ç –ø–æ–¥–¥–µ—Ä–∂–∫—É IDE –∏ type safety
- –î—Ä—É–≥–∏–µ —Å–≤–æ–π—Å—Ç–≤–∞ –≤ —Ç–æ–º –∂–µ –∫–ª–∞—Å—Å–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ —Ç–∏–ø–∏–∑–∏—Ä–æ–≤–∞–Ω—ã

**–†–µ—à–µ–Ω–∏–µ:**
```php
protected Sheets|Drive $service;
```

**–ù–∞–∑–Ω–∞—á–µ–Ω–æ:** –ù–µ –Ω–∞–∑–Ω–∞—á–µ–Ω–æ
**–û—Ü–µ–Ω–∫–∞ —Ç—Ä—É–¥–æ–∑–∞—Ç—Ä–∞—Ç:** 5 –º–∏–Ω—É—Ç

---

## üü° P2 - –°–†–ï–î–ù–ò–ô –ü–†–ò–û–†–ò–¢–ï–¢ (–•–æ—Ä–æ—à–æ –±—ã –∏—Å–ø—Ä–∞–≤–∏—Ç—å)

### 7. Type Safety - –û—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç —Ç–∞–π–ø—Ö–∏–Ω—Ç—ã –≤ DataRow
**–°—Ç–∞—Ç—É—Å:** üü° –°—Ä–µ–¥–Ω–∏–π
**–§–∞–π–ª—ã:**
- `src/Model/DataRow.php:19` - –º–µ—Ç–æ–¥ `getField()`
- `src/Model/DataRow.php:14` - –º–µ—Ç–æ–¥ `setField()`

**–ü—Ä–æ–±–ª–µ–º–∞:**
```php
public function setField(string $name, $value): void  // $value –±–µ–∑ —Ç–∏–ø–∞
public function getField(string $name)  // –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç return type
```

**–†–µ—à–µ–Ω–∏–µ:**
```php
public function setField(string $name, mixed $value): void
public function getField(string $name): mixed
```

**–ù–∞–∑–Ω–∞—á–µ–Ω–æ:** –ù–µ –Ω–∞–∑–Ω–∞—á–µ–Ω–æ
**–û—Ü–µ–Ω–∫–∞ —Ç—Ä—É–¥–æ–∑–∞—Ç—Ä–∞—Ç:** 5 –º–∏–Ω—É—Ç

---

### 8. Type Safety - –û—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç —Ç–∞–π–ø—Ö–∏–Ω—Ç—ã –≤ —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏—è—Ö Mapper
**–°—Ç–∞—Ç—É—Å:** üü° –°—Ä–µ–¥–Ω–∏–π
**–§–∞–π–ª:** `src/Service/Mapper/Mapper.php:19-50`

**–ü—Ä–æ–±–ª–µ–º–∞:**
–ü—Ä–∏–≤–∞—Ç–Ω—ã–µ –º–µ—Ç–æ–¥—ã —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏–∏ –Ω–µ –∏–º–µ—é—Ç —Ç–∞–π–ø—Ö–∏–Ω—Ç–æ–≤ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤:
```php
private function asinValidate($value): ?string
private function cleanString($value): string
private function cleanUPC($value): string
private function cleanInteger($value): int
private function cleanFloat($value): float
```

**–†–µ—à–µ–Ω–∏–µ:**
```php
private function asinValidate(mixed $value): ?string
private function cleanString(mixed $value): string
private function cleanUPC(mixed $value): string
private function cleanInteger(mixed $value): int
private function cleanFloat(mixed $value): float
```

**–ù–∞–∑–Ω–∞—á–µ–Ω–æ:** –ù–µ –Ω–∞–∑–Ω–∞—á–µ–Ω–æ
**–û—Ü–µ–Ω–∫–∞ —Ç—Ä—É–¥–æ–∑–∞—Ç—Ä–∞—Ç:** 10 –º–∏–Ω—É—Ç

---

## ‚úÖ –ò—Ç–æ–≥–∏ –ø–æ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—é –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ

### –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ –æ–±–ª–∞—Å—Ç–∏
- ‚úÖ –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ —Å–ª–æ–µ–≤ (–ú–æ–¥–µ–ª–∏ –Ω–µ —Å–æ–¥–µ—Ä–∂–∞—Ç –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫—É)
- ‚úÖ –ß–∏—Å—Ç–æ—Ç–∞ –º–æ–¥–µ–ª–µ–π (–Ω–µ—Ç –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –æ—Ç —Å–µ—Ä–≤–∏—Å–æ–≤/API)
- ‚úÖ –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤ (–≤—Å–µ 8 InputHandlers —Ä–µ–∞–ª–∏–∑—É—é—Ç InputHandlerInterface)
- ‚úÖ –ö—Ä–∏—Ç–∏—á–Ω—ã–µ —Ñ–∞–π–ª—ã –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É—é—Ç (ConsumerCommand, Aggregator, –≤—Å–µ —Ö—ç–Ω–¥–ª–µ—Ä—ã)
- ‚úÖ –û—Å–Ω–æ–≤–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç constructor DI
- ‚úÖ InputConfig –∏ SubSource –≤–∞–ª–∏–¥–∏—Ä—É—é—Ç –≤ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–∞—Ö
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ match –≤—ã—Ä–∞–∂–µ–Ω–∏—è PHP 8.0+

### –ù–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ –æ–±–ª–∞—Å—Ç–∏
- ‚ùå –ù–∞—Ä—É—à–µ–Ω–∏—è Factory pattern (3 –º–µ—Å—Ç–∞)
- ‚ùå –ù–∞—Ä—É—à–µ–Ω–∏—è type safety (6 –º–µ—Å—Ç)
- ‚ùå –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –≤–∞–ª–∏–¥–∞—Ü–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ (RestApiConfig)
- ‚ùå Runtime –±–∞–≥ (—Å–æ–∑–¥–∞–Ω–∏–µ DataSetCollection)

---

## –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π –¥–æ–ª–≥ (–ó–∞–¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω –≤ CLAUDE.md)

–≠—Ç–∏ –ø—Ä–æ–±–ª–µ–º—ã –ø—Ä–∏–µ–º–ª–µ–º—ã —Å–µ–π—á–∞—Å, –Ω–æ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –≤ –±—É–¥—É—â–µ–º —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–µ:

1. `InputConfig::sourceDecode()` - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∏—Å–∫–ª—é—á–µ–Ω–∏–π –¥–ª—è control flow (—Å—Ç—Ä–æ–∫–∞ 54)
2. `InputConfig::isMultiSource()` - –î–æ–ª–∂–Ω–∞ –ø—Ä–æ–≤–µ—Ä—è—Ç—å —Ç–æ–ª—å–∫–æ –ø–æ type_id, –∞ –Ω–µ –ø—ã—Ç–∞—Ç—å—Å—è –¥–µ–∫–æ–¥–∏—Ä–æ–≤–∞—Ç—å (—Å—Ç—Ä–æ–∫–∞ 68)
3. `Aggregator::getHandlerByType()` - –î–æ–±–∞–≤–∏—Ç—å —Ç–∏–ø –¥–ª—è multi-source —Å—Ü–µ–Ω–∞—Ä–∏—è (—Å—Ç—Ä–æ–∫–∞ 90)
4. Multi-source –¥–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ - –î–æ–ª–∂–Ω–æ –¥–µ–∫–æ–¥–∏—Ä–æ–≤–∞—Ç—å JSON –≤ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–µ InputConfig (—Å—Ç—Ä–æ–∫–∞ 35)

---

## –ú–µ—Ç—Ä–∏–∫–∏

| –ú–µ—Ç—Ä–∏–∫–∞ | –ó–Ω–∞—á–µ–Ω–∏–µ |
|---------|----------|
| –í—Å–µ–≥–æ –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤ | 25 |
| –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –Ω–∞—Ä—É—à–µ–Ω–∏–π | 6 |
| Runtime –±–∞–≥–æ–≤ | 1 |
| –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ | ~75% |
| –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ Type Safety | ~85% |
| –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ Factory Pattern | 60% |

---

## –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω—ã–π –ø–æ—Ä—è–¥–æ–∫ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

1. **–ò—Å–ø—Ä–∞–≤–∏—Ç—å P0-1** (–±–∞–≥ DataSetCollection) - 5 –º–∏–Ω - –ë–õ–û–ö–ò–†–£–ï–¢ RUNTIME
2. **–ò—Å–ø—Ä–∞–≤–∏—Ç—å P0-3** (MorrisXml hardcoded supplier) - 1 —á–∞—Å - –õ–ï–ì–ö–û
3. **–ò—Å–ø—Ä–∞–≤–∏—Ç—å P1-4** (GoogleDriveFolderHandler DI) - 30 –º–∏–Ω - –õ–ï–ì–ö–û
4. **–ò—Å–ø—Ä–∞–≤–∏—Ç—å P1-6** (GoogleApiInputHandler type) - 5 –º–∏–Ω - –õ–ï–ì–ö–û
5. **–ò—Å–ø—Ä–∞–≤–∏—Ç—å P1-5** (RestApiConfig validation) - 30 –º–∏–Ω
6. **–ò—Å–ø—Ä–∞–≤–∏—Ç—å P0-2** (Aggregator factories) - 2-3 —á–∞—Å–∞ - –°–ê–ú–û–ï –°–õ–û–ñ–ù–û–ï
7. **–ò—Å–ø—Ä–∞–≤–∏—Ç—å P2-7 –∏ P2-8** (Type hints) - 15 –º–∏–Ω –≤—Å–µ–≥–æ

**–û–±—â–∞—è –æ—Ü–µ–Ω–∫–∞ —Ç—Ä—É–¥–æ–∑–∞—Ç—Ä–∞—Ç:** ~5-6 —á–∞—Å–æ–≤

---

## –ü—Ä–∏–º–µ—á–∞–Ω–∏—è

- –í—Å–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –¥–æ–ª–∂–Ω—ã –≤–∫–ª—é—á–∞—Ç—å unit-—Ç–µ—Å—Ç—ã
- –ü–æ—Å–ª–µ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞ —Ñ–∞–±—Ä–∏–∫ –æ–±–Ω–æ–≤–∏—Ç—å services.yaml –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏
- –û–±–µ—Å–ø–µ—á–∏—Ç—å –æ–±—Ä–∞—Ç–Ω—É—é —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º–∏ Kafka —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏
- –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–æ –≤—Å–µ–º–∏ 8 —Ç–∏–ø–∞–º–∏ input handler –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π
